<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>tufao: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">tufao
   &#160;<span id="projectnumber">0.6.0</span>
   </div>
   <div id="projectbrief">An asynchronous web framework for C++ built on top of Qt</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">tufao Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#tufao-overview">Introduction</a></li>
<li class="level1"><a href="#tufao-introduction">Creating a Tufão-based application</a><ul><li class="level2"><a href="#tufao-hello">Hello World!</a></li>
<li class="level2"><a href="#tufao-code">And then, there was the code</a></li>
<li class="level2"><a href="#tufao-build">Build system integration</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="tufao-overview"></a>
Introduction</h1>
<p>Tufão is a web framework for C++ that makes use of Qt's object communication system (signals &amp; slots). It features:</p>
<ul>
<li>High performance standalone server</li>
<li>Cross-plataform support</li>
<li>Good documentation</li>
<li>Support modern HTTP features<ul>
<li>Persistent streams</li>
<li>Chunked entities</li>
<li>100-continue status</li>
<li>WebSocket</li>
</ul>
</li>
<li>HTTPS support</li>
<li>Flexible request router</li>
<li>Static file server with support for conditional requests and partial download</li>
<li>Plugin-based server to allow change the running code without restart the application</li>
<li>Flexible and secure session support</li>
<li>QtCreator's plugin to allow create new applications rapidly</li>
<li>Timeout support</li>
</ul>
<p>It uses Ryan Dahl's HTTP parser to provide good performance.</p>
<h1><a class="anchor" id="tufao-introduction"></a>
Creating a Tufão-based application</h1>
<p>In this section, I assume that you already have installed Tufão libraries and tools (tufao-routes-editor, QtCreator's plugin, ...).</p>
<h2><a class="anchor" id="tufao-hello"></a>
Hello World!</h2>
<div class="image">
<img src="get_started_1.png" alt="get_started_1.png"/>
<div class="caption">
QtCreator's Tufão plugin</div></div>
<p> First of all, you must open QtCreator and go to the new project dialog, you may be able to select Tufão Web Server project from the list of projects in the Tufão category.</p>
<div class="image">
<img src="get_started_2.png" alt="get_started_2.png"/>
<div class="caption">
Tufão Web Server project templates</div></div>
<p> Go through the pages of the project wizard, selecting the <em>application</em> template. At the end, you'll get an unconfigured qmake-based application. Under QtCreator's interface, go to the <em>projects mode</em> and choose a configuration. If you don't configure the project, QtCreator won't be able to compile your project.</p>
<h2><a class="anchor" id="tufao-code"></a>
And then, there was the code</h2>
<p>You may have a <em>main.cpp</em> file with a code like this:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;QtCore/QCoreApplication&gt;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;Tufao/HttpServer&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;Tufao/HttpServerRequestRouter&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;Tufao/HttpFileServer&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;Tufao/HttpPluginServer&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;notfound.h&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;pluginreloader.h&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;{</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    Q_INIT_RESOURCE(<span class="keyword">static</span>);</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    <span class="comment">// First we create the event loop and the server objects</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    QCoreApplication a(argc, argv);</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <a class="code" href="class_tufao_1_1_http_server.html" title="The Tufao::HttpServer class provides an implementation of the HTTP protocol.">Tufao::HttpServer</a> server;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="comment">// Then we create a request router and configure it...</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <a class="code" href="class_tufao_1_1_http_server_request_router.html" title="This class provides a robust and high performance HTTP request router.">Tufao::HttpServerRequestRouter</a> router;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="comment">//   ...using some handlers</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="comment">// to allow you change the running code without restart the application</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <a class="code" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler.">Tufao::HttpPluginServer</a> pluginServer(<span class="stringliteral">&quot;routes.conf&quot;</span>);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="comment">// do a request to http://localhost:8080/reload to reload the plugins</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    PluginReloader pluginReloader(&amp;pluginServer);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">// to server static files under public folder</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <a class="code" href="class_tufao_1_1_http_file_server.html" title="You can use this class to serve static files under Tufão.">Tufao::HttpFileServer</a> fileServer(<span class="stringliteral">&quot;public&quot;</span>);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">// to respond the remaining requests with a &quot;404 - not found&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    NotFoundHandler handler404;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">// you should also create handlers to:</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="comment">//   - &quot;/&quot; (maybe redirecting to some other path)</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">//   - &quot;/favicon.ico&quot; (to serve the page&#39;s icon)</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    router.<a class="code" href="class_tufao_1_1_http_server_request_router.html#a53c5ce95672cb8749fb03e0fa2b55cef" title="This method maps requests which path components in the url matches the regular expression path to the...">map</a>(QRegExp(<span class="stringliteral">&quot;&quot;</span>), &amp;pluginServer)</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;            .<a class="code" href="class_tufao_1_1_http_server_request_router.html#a53c5ce95672cb8749fb03e0fa2b55cef" title="This method maps requests which path components in the url matches the regular expression path to the...">map</a>(QRegExp(<span class="stringliteral">&quot;^/reload$&quot;</span>), &amp;pluginReloader)</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;            .<a class="code" href="class_tufao_1_1_http_server_request_router.html#a53c5ce95672cb8749fb03e0fa2b55cef" title="This method maps requests which path components in the url matches the regular expression path to the...">map</a>(QRegExp(<span class="stringliteral">&quot;&quot;</span>), &amp;fileServer)</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            .<a class="code" href="class_tufao_1_1_http_server_request_router.html#a53c5ce95672cb8749fb03e0fa2b55cef" title="This method maps requests which path components in the url matches the regular expression path to the...">map</a>(QRegExp(<span class="stringliteral">&quot;&quot;</span>), &amp;handler404);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="comment">// We set the router as the global request handler</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    QObject::connect(&amp;server, SIGNAL(requestReady(<a class="code" href="class_tufao_1_1_http_server_request.html" title="The Tufao::HttpServer represents a HTTP request received by Tufao::HttpServer.">Tufao::HttpServerRequest</a>*,<a class="code" href="class_tufao_1_1_http_server_response.html" title="The Tufao::HttpServerResponse is used to respond to a Tufao::HttpServerRequest.">Tufao::HttpServerResponse</a>*)),</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                     &amp;router, SLOT(handleRequest(<a class="code" href="class_tufao_1_1_http_server_request.html" title="The Tufao::HttpServer represents a HTTP request received by Tufao::HttpServer.">Tufao::HttpServerRequest</a>*,<a class="code" href="class_tufao_1_1_http_server_response.html" title="The Tufao::HttpServerResponse is used to respond to a Tufao::HttpServerRequest.">Tufao::HttpServerResponse</a>*)));</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// Last, we run our server...</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    server.<a class="code" href="class_tufao_1_1_http_server.html#a53ebaa69281886b1b8c2b535aaec8cd9" title="Tells the server to listen for incoming connections on address address and port port.">listen</a>(QHostAddress::Any, 8080);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">//   ...and start the event loop    </span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">return</span> a.exec();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;}</div>
</div><!-- fragment --><p>A main file with 50 lines of code. It's a bunch of code, but if you delete the comments and includes, you'll have only 30 lines remaining. It's possible to create Tufão applications with fewer yet lines, but I'll use this code to explain important Tufão features. They'll prove their value.</p>
<p>Tufão provides a web framework and has its own HTTP server (based on Ryan Dahl's HTTP parser). This design give you greater control over the applications and can really boost its performance. But, as uncle Ben may have told you:</p>
<blockquote class="doxtable">
<p>With great power comes great responsibility</p>
<p></p>
</blockquote>
<p>This may sound scary to you at first, but don't worry, the Tufão team will do their best to make this responsibility easier to assume, with each realease. But you need to promisse that you'll use Tufão facilities and read the documentation.</p>
<p>To use the Tufão HTTP server, we instantiate, as show in the line 17, a <a class="el" href="class_tufao_1_1_http_server.html" title="The Tufao::HttpServer class provides an implementation of the HTTP protocol.">Tufao::HttpServer</a>, put it to listen on port 8080, as show in the line 46, and start a event loop, as show in the line 49. This server will expose all we need to this introduction.</p>
<p>The <a class="el" href="class_tufao_1_1_http_server.html" title="The Tufao::HttpServer class provides an implementation of the HTTP protocol.">Tufao::HttpServer</a> will emit the <a class="el" href="class_tufao_1_1_http_server.html#a4e2132f99a108a3a1638c38e1695f12c" title="This signal is emitted each time there is request.">Tufao::HttpServer::requestReady</a> signal each time a request comes. We can handle all requests in a single place in the code, but we won't do that, because... em... as some wise person said before, we need:</p>
<blockquote class="doxtable">
<p><a href="https://en.wikipedia.org/wiki/Divide_and_conquer">Divide and conquer</a></p>
<p></p>
</blockquote>
<p>We could decompose our slot into some functions to do the job. But we won't do that, because Tufão already has a better abstraction for the problem, <a class="el" href="class_tufao_1_1_http_server_request_router.html" title="This class provides a robust and high performance HTTP request router.">Tufao::HttpServerRequestRouter</a>.</p>
<p>The idea behind <a class="el" href="class_tufao_1_1_http_server_request_router.html" title="This class provides a robust and high performance HTTP request router.">Tufao::HttpServerRequestRouter</a> is have a chain of request handlers and mapped paths to them. If a request comes to a handler unable to handle it, the request is delegated to another handler in the chain.</p>
<p>In the code, we have one router (line 20) and four handlers (lines 25, 27, 29 and 31). In the lines 36 to 39 we bind the router and the handlers and in the line 42 we bind the router and the server. The handlers, in order, are:</p>
<ul>
<li><a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler.">Tufao::HttpPluginServer</a>: Uses plugins to handle the requests. A plugin mechanism is what allows you to change the running code without restart the application. In this code, we use the file routes.conf (editable with the tufao-routes-editor tool) to configure the plugins.</li>
<li>PluginReloader: A custom class (defined in the files <em>pluginreloader.h</em> and <em>pluginreloader.cpp</em>) that instructs the pluginServer to refresh the list of plugins. For security reasons, it'll only accept requests originated from local host.</li>
<li><a class="el" href="class_tufao_1_1_http_file_server.html" title="You can use this class to serve static files under Tufão.">Tufao::HttpFileServer</a>: Serve static files. We use the folder <em>public</em> as root dir.</li>
<li>NotFoundHandler: A custom class (defined in the files <em>notfound.h</em> and <em>notfound.cpp</em>) that responds to every request with a 404 status code. It will use the file <em>notfound.html</em> embedded in the binary (through the Qt resource system) as message body of the responses. Line 14 init the necessary resource.</li>
</ul>
<p>If you run this application, you see the error <em>Unsupported config file version</em>. This is happening because you didn't prepare a <em>routes.conf</em> file to feed the plugin handler. See <a class="el" href="pluginsystem.html">Tufão's plugin system</a> to learn how to fix it and add a plugin-based handler to the application. The file <em>routes.conf</em> must be placed in the working dir from where the application will run (or is running).</p>
<p>If you access <a href="http://localhost:8080/">http://localhost:8080/</a> you'll see a message telling you that the page wasn't found. Create a folder called public in the working dir of the executable and put a file called index.html there: </p>
<pre class="fragment">&lt;html&gt;
  &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
  &lt;head&gt;&lt;title&gt;Hello World&lt;/title&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Congratulations,&lt;/h1&gt;
    &lt;p&gt;you are able to start web development in C++ with Tufão&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre><p>Now access the page <a href="http://localhost:8080/index.html">http://localhost:8080/index.html</a> and see the result. As an exercise, I left the task to add a <a href="https://en.wikipedia.org/wiki/Favicon">favicon</a> to your application using the <a class="el" href="pluginsystem.html">Tufão's plugin system</a>.</p>
<h2><a class="anchor" id="tufao-build"></a>
Build system integration</h2>
<p>The Tufão has native support to three build systems: qmake, pkgconfig and CMake.</p>
<p>Once Tufão is correctly installed, you can use Tufão in your qmake-based applications appending the following line to your project file, where <em>x</em> is the major version (0 for Tufão 0.x) you want to use: </p>
<pre class="fragment">CONFIG += TUFAOx
</pre><p>If you use CMake, just follow the common steps (require package and handle compile and link flags) in your CMakeLists.txt file: </p>
<pre class="fragment">find_package(Tufao 0.4 REQUIRED)
include_directories("${TUFAO_INCLUDE_DIR}")
target_link_libraries(foobar ${TUFAO_LIBRARIES})
</pre><p>If you want to use a FindTufao.cmake file embedded in your project dir, add the following line to your CMakeLists.txt: </p>
<pre class="fragment">set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "/path/to/FindTufao.cmake")
</pre><p>If you want to use autotools or another build system that has pkgconfig support, you can use the Tufão's pkgconfig module, where <em>x</em> is the major version (0 for Tufão 0.x) you want to use: </p>
<pre class="fragment">$ pkg-config tufaox
</pre><p>If want to use a build system that don't support pkgconfig, you should be ashamed, but you may still be able to use Tufão (probably editing the compiler -I flag and the linker -L and -l flags). </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Mar 21 2013 15:52:44 for tufao by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
