<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>tufao: Tufão&#39;s plugin system</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">tufao
   &#160;<span id="projectnumber">0.8.1</span>
   </div>
   <div id="projectbrief">An asynchronous web framework for C++ built on top of Qt</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('pluginsystem.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tufão's plugin system </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#plugin-hello">Understanding by example</a><ul><li class="level2"><a href="#plugin-pluginserver">The Tufao::HttpPluginServer class</a></li>
<li class="level2"><a href="#plugin-user">The plugin</a></li>
<li class="level2"><a href="#plugin-editor">tufao-routes-editor</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>When you are developing web applications, usually you are faced with the problem of develop applications that will be running for years, without stop.</p>
<p>Solutions in interpreted languages usually handle this problem by reloading the source file each time it changes. In C++, we can achieve a similar behaviour through plugins.</p>
<p>Tufão provides the class <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">Tufao::HttpPluginServer</a>, the application <em>tufao-routes-editor</em> and a QtCreator's plugin to facilitate the integration of Qt plugins and <a class="el" href="class_tufao_1_1_http_server_request_router.html" title="This class provides a robust and high performance HTTP request router. ">Tufao::HttpServerRequestRouter</a>.</p>
<h1><a class="anchor" id="plugin-hello"></a>
Understanding by example</h1>
<p>To help you understand the Tufão's plugin system, let's revisit the application created in <a class="el" href="index.html#tufao-introduction">Creating a Tufão-based application</a>. This application should be the same generated by the <em>application</em> template, under Tufão QtCreator's plugin.</p>
<h2><a class="anchor" id="plugin-pluginserver"></a>
The Tufao::HttpPluginServer class</h2>
<p>The <a class="el" href="class_tufao_1_1_http_server_request_router.html" title="This class provides a robust and high performance HTTP request router. ">Tufao::HttpServerRequestRouter</a> provides a robust request router interface and would be useful if we could tell it to use a plugin located in the file system as a handler. This is where <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">Tufao::HttpPluginServer</a> enters.</p>
<p><a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">Tufao::HttpPluginServer</a> implements the <a class="el" href="class_tufao_1_1_abstract_http_server_request_handler.html" title="This class provides an interface for HttpServerRequest handlers. ">Tufao::AbstractHttpServerRequestHandler</a> interface, then you can use it as a handler in <a class="el" href="class_tufao_1_1_http_server_request_router.html" title="This class provides a robust and high performance HTTP request router. ">Tufao::HttpServerRequestRouter</a>. <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">Tufao::HttpPluginServer</a> has its own set of mapping rules and handlers, but it will load its handlers from plugins.</p>
<p>In the plugin server created previously, we pass a file in the constructor. This is how we set the plugins from <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">Tufao::HttpPluginServer</a>. This file can be edited using the tufao-routes-editor tool (see <a class="el" href="pluginsystem.html#plugin-editor">tufao-routes-editor</a>).</p>
<h2><a class="anchor" id="plugin-user"></a>
The plugin</h2>
<div class="image">
<img src="qtcreator_pluginserver.png" alt="qtcreator_pluginserver.png"/>
<div class="caption">
The plugin template</div></div>
<p> Enough text! Let's create our plugin. First, you must open QtCreator, go to the new project dialog and select the <em>plugin</em> template in the <em>Tufão Web Server project</em>.</p>
<p>You'll get the following files:</p>
<ul>
<li>*.pro: The name of this file depends on the name of the project. Tells qmake to use the <em>lib</em> <em>TEMPLATE</em> and the <em>plugin</em> <em>CONFIG</em>.</li>
<li>plugin.h: Defines a class that implements the <a class="el" href="class_tufao_1_1_abstract_http_server_request_handler_factory.html" title="This class provides an factory interface to create AbstractHttpServerRequestHandler objects...">Tufao::AbstractHttpServerRequestHandlerFactory</a> interface, needed by <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">Tufao::HttpPluginServer</a>.</li>
<li>plugin.cpp: Contains the implementation of Plugin members and uses the <em>Q_EXPORT_PLUGIN2</em> macro to export the plugin.</li>
<li>requesthandler.h: This is your request handler class. Do whatever you want here (but remember to update the plugin.cpp if you change the class or file name).</li>
<li>requesthandler.cpp: Contains the implementation of RequestHandler members.</li>
</ul>
<p>The <a class="el" href="class_tufao_1_1_abstract_http_server_request_handler_factory.html" title="This class provides an factory interface to create AbstractHttpServerRequestHandler objects...">Tufao::AbstractHttpServerRequestHandlerFactory</a> class is just a <a href="https://en.wikipedia.org/wiki/Factory_method_pattern">factory</a> used by <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">Tufao::HttpPluginServer</a> to instantiate new <a class="el" href="class_tufao_1_1_abstract_http_server_request_handler.html" title="This class provides an interface for HttpServerRequest handlers. ">Tufao::AbstractHttpServerRequestHandler</a> objects. If you intend to create a plugin to be used by <a class="el" href="class_tufao_1_1_http_plugin_server.html" title="This class provides a plugin-based request handler. ">Tufao::HttpPluginServer</a>, you must:</p>
<ol type="1">
<li>Use Qt's plugin system</li>
<li>Implement the <a class="el" href="class_tufao_1_1_abstract_http_server_request_handler_factory.html" title="This class provides an factory interface to create AbstractHttpServerRequestHandler objects...">Tufao::AbstractHttpServerRequestHandlerFactory</a> interface in the plugin class (and don't forget the <em>Q_INTERFACES</em> macro)</li>
</ol>
<h2><a class="anchor" id="plugin-editor"></a>
tufao-routes-editor</h2>
<p>Finally we have:</p>
<ul>
<li>An application supporting plugins</li>
<li>A plugin</li>
</ul>
<p>The only thing missing here is tell the application to use the plugin we created. To do that, we need:</p>
<ul>
<li>Edit the config file used by the plugin server of our application. In the previous application, this file is any file named <em>routes.conf</em> placed in the application's working dir.</li>
</ul>
<div class="image">
<img src="routes_editor.png" alt="routes_editor.png"/>
<div class="caption">
tufao-routes-editor tool</div></div>
<p> To accomplish the final step, the <em>routes.conf</em> file, you must use <em>tufao-routes-editor</em> tool. Open the tool, click in "Add handler" and you'll have access to the mapping rules. In the field "Plugin location", you must put the path of the compiled object file generated from the plugin project. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Jan 1 2014 03:09:27 for tufao by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
