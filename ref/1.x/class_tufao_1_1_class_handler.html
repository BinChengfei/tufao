<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>tufao: Tufao::ClassHandler Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="tufao_logo.svg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">tufao
   &#160;<span id="projectnumber">1.2.0</span>
   </div>
   <div id="projectbrief">An asynchronous web framework for C++ built on top of Qt</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('class_tufao_1_1_class_handler.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="class_tufao_1_1_class_handler-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Tufao::ClassHandler Class Reference<span class="mlabels"><span class="mlabel">abstract</span></span></div>  </div>
</div><!--header-->
<div class="contents">

<p>The <a class="el" href="class_tufao_1_1_class_handler.html" title="The ClassHandler class Define the interface to implement when creating a plugin. ">ClassHandler</a> class Define the interface to implement when creating a plugin.  
 <a href="class_tufao_1_1_class_handler.html#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for Tufao::ClassHandler:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_tufao_1_1_class_handler__inherit__graph.png" border="0" usemap="#_tufao_1_1_class_handler_inherit__map" alt="Inheritance graph"/></div>
<map name="_tufao_1_1_class_handler_inherit__map" id="_tufao_1_1_class_handler_inherit__map">
</map>
</div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for Tufao::ClassHandler:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="class_tufao_1_1_class_handler__coll__graph.png" border="0" usemap="#_tufao_1_1_class_handler_coll__map" alt="Collaboration graph"/></div>
<map name="_tufao_1_1_class_handler_coll__map" id="_tufao_1_1_class_handler_coll__map">
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:acd1bc7f1c39ffe9f696f59d39c33a0b9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acd1bc7f1c39ffe9f696f59d39c33a0b9"></a>
virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tufao_1_1_class_handler.html#acd1bc7f1c39ffe9f696f59d39c33a0b9">deinit</a> ()=0</td></tr>
<tr class="memdesc:acd1bc7f1c39ffe9f696f59d39c33a0b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean up resource; called automatically before plugin is unloaded. <br/></td></tr>
<tr class="separator:acd1bc7f1c39ffe9f696f59d39c33a0b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d37763ce58c513fb97a40d03b86c080"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8d37763ce58c513fb97a40d03b86c080"></a>
virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tufao_1_1_class_handler.html#a8d37763ce58c513fb97a40d03b86c080">init</a> ()=0</td></tr>
<tr class="memdesc:a8d37763ce58c513fb97a40d03b86c080"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize an instance for use; alled automatically when plugin is registered. <br/></td></tr>
<tr class="separator:a8d37763ce58c513fb97a40d03b86c080"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4aadfc51ca2e4fc79194e8e5abd7d57b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4aadfc51ca2e4fc79194e8e5abd7d57b"></a>
virtual <a class="el" href="struct_tufao_1_1_class_handler_plugin_info.html">ClassHandlerPluginInfo</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tufao_1_1_class_handler.html#a4aadfc51ca2e4fc79194e8e5abd7d57b">getPluginInfo</a> () const =0</td></tr>
<tr class="memdesc:a4aadfc51ca2e4fc79194e8e5abd7d57b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get information about the plugin. <br/></td></tr>
<tr class="separator:a4aadfc51ca2e4fc79194e8e5abd7d57b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a32817c150c1f89821be4ce5592fd6d05"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a32817c150c1f89821be4ce5592fd6d05"></a>
static const QString&#160;</td><td class="memItemRight" valign="bottom"><b>HttpResponseStatusKey</b></td></tr>
<tr class="separator:a32817c150c1f89821be4ce5592fd6d05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43a73c965f0888e3564a935797479a24"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a43a73c965f0888e3564a935797479a24"></a>
static const QString&#160;</td><td class="memItemRight" valign="bottom"><b>JsonResponseKey</b></td></tr>
<tr class="separator:a43a73c965f0888e3564a935797479a24"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The <a class="el" href="class_tufao_1_1_class_handler.html" title="The ClassHandler class Define the interface to implement when creating a plugin. ">ClassHandler</a> class Define the interface to implement when creating a plugin. </p>
<p>This interface is used by the <a href="http://qt-project.org/doc/qt-5.0/qtcore/qpluginloader.html">QPluginLoader </a> to load plugins dynamically.</p>
<p>This class is intended to be used in a very specific way. If it is used in that way, and linked into a library, then <a class="el" href="namespace_tufao.html" title="This is the namespace where all Tufão facilities are grouped. ">Tufao</a> can automatically dispatch incoming requests to this class, and more specifically, to specific methods defined in this class. This allows the developer to just write a class, and not need to worry about crazy regular expressions, and then logic to determine what should be done (action to perform) with the traditional <a class="el" href="class_tufao_1_1_abstract_http_server_request_handler.html" title="This class provides an interface for HttpServerRequest handlers. ">AbstractHttpServerRequestHandler</a>. As the <a class="el" href="class_tufao_1_1_abstract_http_server_request_handler.html" title="This class provides an interface for HttpServerRequest handlers. ">AbstractHttpServerRequestHandler</a> can only have one dispatch-able method, it would have been up to the developer to determine what logic to execute based on the request, or to have a large number of classes &amp; a large number of regular expressions to map to those classes.</p>
<p>This is achieved by breaking the URL paths up into a parameter list, and then invoking a method on the subclass and passing the parameters to that method. So a URL request like: <code>/forum/read/forumName/someForumName/threadName/someThreadName/page/6</code> would call a method Forum::read(QString forumName, QString threadName, int pageNumber) as read("someForumName", "someThreadName", 6);. (please read below for a more accurate description). This would take a user to a forum named <em>someForumName</em>, to a topic named <em>someThreadName</em>, to the <em>6</em>th page of responses.</p>
<p>This format is intended to follow the general ReST tenants of resource location, and map them to a method implemented on a <a class="el" href="class_tufao_1_1_class_handler.html" title="The ClassHandler class Define the interface to implement when creating a plugin. ">ClassHandler</a>. In this example, some resource named <em>forum</em> has a sub-resource named <em>forumName</em>, and that sub-resource further has a sub-resource named <em>threadName</em>, and finally, a further sub-resource of <em>page</em>. Each of the first two resources are found by a string, and the last resource is found by an int.</p>
<p>To use this class, there are a few conventions you must follow, and the class needs to be compiled into a plugin. First I'll talk about the implementation, and then I'll talk about the packaging.</p>
<h2>Implementation</h2>
<h3>Creating a Class to match a path</h3>
<p>All subclasses must be <em>Q_OBJECT</em>'s. Further, two additional macro's must be used: <em>Q_PLUGIN_METADATA(IID "tufao.Test/1.0")</em> and <em>Q_INTERFACES(Tufao::ClassHandler)</em>. The second macro must be exact, and is what Qt uses to know the class implements the <a class="el" href="class_tufao_1_1_class_handler.html" title="The ClassHandler class Define the interface to implement when creating a plugin. ">ClassHandler</a> interface. The first macro defines metadata about the plugin, specifically the IID of the plugin. The string can be anything meaningful, but is typically the now-common reverse resource locator used by so many languages. So if you were with the Stellarium project, the IID would be something like <em>org.stellarium.PluginName/1.0</em> where <em>PluginName</em> would be name of this specific plugin, and <em>1.0</em> would be the plugin version.</p>
<p>In the URL, the first path component is the object name (technically, if a context is being used, the context will be the first path component - see <a class="el" href="class_tufao_1_1_class_handler_manager.html" title="This class serves as the HttpServerRequestHandler for all ClassHandler plugins. ">ClassHandlerManager</a> - but that is transparent to implementing this class). In your constructor, you should call <code>setObjectName("forum");</code> where the parameter is what you want matched in the URL path. For clarity, using the name of the class itself is a good idea. As it is case-sensitive, you may want to use the lower case version. Once this is done, incoming requests that match the object name will be dispatched (if they match a method; see below).</p>
<h3>Implementing methods as end-points</h3>
<p>The next path component is the name of a method in the class. The method name must match exactly, and is case- sensitive. The method should be a <code>public slot</code>, and the signature of the method is very important. The method must accept at least two parameters, and they must be <code><a class="el" href="class_tufao_1_1_http_server_request.html" title="The Tufao::HttpServer represents a HTTP request received by Tufao::HttpServer. ">Tufao::HttpServerRequest</a> &amp; request, <a class="el" href="class_tufao_1_1_http_server_response.html" title="The Tufao::HttpServerResponse is used to respond to a Tufao::HttpServerRequest. ">Tufao::HttpServerResponse</a> &amp; response</code>. The parameter names must be that exactly, as the dispatch uses parameter names of the methods to find the correct method to dispatch to. Further, the parameter types are used to convert the strings of the URL path to the data types the method requires.</p>
<p>As these two parameters must be on every method, the simplest method could have would have these two parameters. This allows you access to the request if you need it, and the response to write out the information back to the requester.</p>
<p>In the above example, the actual declaration of the method would be: <code>void read(<a class="el" href="class_tufao_1_1_http_server_request.html" title="The Tufao::HttpServer represents a HTTP request received by Tufao::HttpServer. ">Tufao::HttpServerRequest</a> &amp; request, <a class="el" href="class_tufao_1_1_http_server_response.html" title="The Tufao::HttpServerResponse is used to respond to a Tufao::HttpServerRequest. ">Tufao::HttpServerResponse</a> &amp; response, QString forumName, QString threadName, int pageNumber)</code>. The parameter names are used to match the path components in the URL. This means that a URL will always have an <em>even number</em> of path components after the class name; half for the name of the parameters, and the other half for the values. If a value cannot be converted to the type of the parameter, the request is not handled, and a message logged. So the request would end up passing to the next registered <a class="el" href="class_tufao_1_1_abstract_http_server_request_handler.html" title="This class provides an interface for HttpServerRequest handlers. ">AbstractHttpServerRequestHandler</a> registered with the HttpRequestRouter.</p>
<p>If a context has been assigned to the <a class="el" href="class_tufao_1_1_class_handler_manager.html" title="This class serves as the HttpServerRequestHandler for all ClassHandler plugins. ">ClassHandlerManager</a> that is responsible for this plugin, it is also important to check to see if the request has a context. This is done simply with <code>!request.context().isEmpty()</code>. If the context is not empty, yo may need to set it into the output, so that any URL's refernced (either in HTML or in Ajax) can prepend the context to there paths. If you are the sole user of your plugin, and you know what context you are going to use, you can avoid this and directly use the context in your HTML.</p>
<p>Finally, as the user has no control over instance lifetime (creation is done at application start for static plugins and load-time for dynamic ones, and objects are destroyed at application termination for static plugins and when the plugin is unloaded for dynamic ones), there are <code>void <a class="el" href="class_tufao_1_1_class_handler.html#a8d37763ce58c513fb97a40d03b86c080" title="Initialize an instance for use; alled automatically when plugin is registered. ">init()</a></code> and <code>void <a class="el" href="class_tufao_1_1_class_handler.html#acd1bc7f1c39ffe9f696f59d39c33a0b9" title="Clean up resource; called automatically before plugin is unloaded. ">deinit()</a></code> methods that are called before an instance is dispatched to, and before shutdown. This allows for the creation or obtaining of resources that should not be attempted until the QCoreApplication is running, and that should be freed before the QCoreApplication is terminated.</p>
<h2>Packaging</h2>
<p>This class is also the superclass for plugins. One you subclass, you compile that code into either a dynamic or a static plugin. Dynamic plugins are a bit more robust in this case, and you can find an example project in the examples directory, named sample_plugin, that has a project with an executable as well as a dynamic plugin. You can use the cmake files for your own project.</p>
<p>If using a static plugins, you can load as many plugins as you like, but, they will all be connected to the same context (if used; see <a class="el" href="class_tufao_1_1_class_handler_manager.html" title="This class serves as the HttpServerRequestHandler for all ClassHandler plugins. ">ClassHandlerManager</a>). This is because there is not way to determine what the IID of the plugin is when loaded statically.</p>
<p>If using a dynamic plugin, the plugin must be installed into a path where it will be found. This includes all of the following: </p>
<ul>
<li>
Every entry in the OS's library path with a <em>Tofao</em> sub-directory </li>
<li>
<em>/Library/Application Support/Tufao</em> on Mac. </li>
<li>
<em>~/Library/Application Support/Tufao</em> on Mac. </li>
<li>
<em>~/.tufao</em> on UNIX (non-Mac). </li>
<li>
The CWD of the application itself </li>
</ul>
<p>Each of these paths is searched for a plugins subdirectory. Each entry in that directory that is a dynamic library is loaded if it implements the <a class="el" href="class_tufao_1_1_class_handler.html" title="The ClassHandler class Define the interface to implement when creating a plugin. ">ClassHandler</a> interface. </p>
<div class="fragment"></div><!-- fragment --> <dl class="section since"><dt>Since</dt><dd>1.2 </dd></dl>
</div><hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="classhandler_8h_source.html">classhandler.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespace_tufao.html">Tufao</a></li><li class="navelem"><a class="el" href="class_tufao_1_1_class_handler.html">ClassHandler</a></li>
    <li class="footer">Generated on Thu Feb 27 2014 07:17:04 for tufao by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
